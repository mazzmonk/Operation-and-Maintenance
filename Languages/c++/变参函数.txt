变参函数指函数的参数个数大于1个,但是不确定个数和类型
这里是定义

    //可变参数标准宏头文件  
    #include "stdarg.h"  
      
    //申明va_list数据类型变量pvar，该变量访问变长参数列表中的参数。  
    va_list pvar;  
      
    //宏va_start初始化变长参数列表。pvar是va_list型变量，记载列表中的参数信息。  
    //parmN是省略号"..."前的一个参数名，va_start根据此参数，判断参数列表的起始位置。  
    va_start(pvar, parmN);  
      
    //获取变长参数列表中参数的值。pvar是va_list型变量，type为参数值的类型，也是宏va_arg返回数值的类型。  
    //宏va_arg执行完毕后自动更改对象pvar，将其指向下一个参数。  
    va_arg(pvar, type);  
      
    //关闭本次对变长参数列表的访问。  
    va_end(pvar);  

这里定义了一个函数模板
    #include <stdarg.h>  
    function (parmN, ...)  
    {  
      
        va_list pvar;   
        va_start (pvar, parmN);  
        while(...)  
        {  
            ...  
                f = va_arg (pvar, type);  
            ...  
        }  
        va_end (pvar);  
    }  

使用

    #include "stdarg.h"  
    using namespace std;  
      
    int sum(int count, ...)  
    {  
        int sum_value=0;  
      
        va_list args;  
        va_start(args,count);  
        while(count--)  
        {  
            sum_value+=va_arg(args,int);  
        }  
        va_end(args);  
      
        return sum_value;  
    }  
      
    int _tmain(int argc, _TCHAR* argv[])  
    {  
        cout<<sum(5,1,2,3,4,5);//输出15  
    }  


描述
 标准头文件stdarg.h提供了一套对可变参函数的实现机制，所以编写可变参函数需要包含该头文件。#include<stdarg.h>

C中变长实参头文件stdarg.h提供了一个数据类型va-list和三个宏（va-start、va-arg和va-end），用它们在被调用函数不知道参数个数和类型时对可变参数表进行测试，从而为访问可变参数提供了方便且有效的方法。va-list是一个char类型的指针，当被调用函数使用一个可变参数时，它声明一个类型为va-list的变量，该变量用来指向va-arg和va-end所需信息的位置。

VC++中va_list、va_start、va_arg、va_end的细节：

va_list：                   
    typedef char *  va_list; 
    
va_start:
    #define _INTSIZEOF(n)   ( (sizeof(n) + sizeof(int) - 1) & ~(sizeof(int) - 1) )
    #define _crt_va_start(ap,v)  ( ap = (va_list)_ADDRESSOF(v) + _INTSIZEOF(v) )
		作用:va_start的第一个参数是va_list变量指针,第二个参数应该传可变参函数的最后一个固定形参,其作用是使va_list类型的指针指向变参函数的第一个可变形参.

va_arg:
    #define _crt_va_arg(ap,t)    ( *(t *)((ap += _INTSIZEOF(t)) - _INTSIZEOF(t)) )
		作用:va_arg宏从上面的实现代码可以看出,其具有两个作用:第一是使va_list类型的指针指向下一个可变参数;第二是获取va_list类型指针指向的值.va_arg宏的第一个参数是va_list变量,第二个参数是待获取的参数的数据类型.

va_end:
    #define _crt_va_end(ap)      ( ap = (va_list)0 )
    作用:va_end主要是对资源释放,使va_list类型的指针不指向任何内存.

    从上面对va_list、va_start、va_arg、va_end的分析可以知道,要编写可变长参数函数,我们首先要定义一个va_list类型的变量arg_ptr,然后使用va_start(arg_ptr,arg_list)宏使变量arg_ptr指向对一个可变形参,然后才能使用va_arg获取各个变参的值,在最后一定要使用va_end宏释放资源.

3、可变长参数函数的实现

分析:在上文的设计分析中,对于va_arg宏的使用有两个比较关键的点,第一个是可变形参的参数个数;第二就是可变形参的参数类型,因为va_arg要根据参数的类型寻址;若知道参数的个数和参数的类型,则可变参函数的实现较为简单;否则,我们要编写一些逻辑去判断实现. 

