nps 用于内网穿透使用,主要用于在通过一个公网的 ip 地址作为代理然后和和内网的需要连接的一台机器做隧道连接.然后通过公网 ip 的代理端口连接到内网的服务器上神器,神器
项目地址:
https://github.com/cnlh/nps

主要说明一下配置
项目是用 go 语言编写,服务端和客户端是分开的

此项目有个缺点,就是服务端的使用的参数选项 -config xxxx 没什么用,同时没法在一个配置文件中多个端口


这里打个比方,通过代理IP的端口连接到内网的 22 端口,使用 tcp 协议

服务端是部署在具有公网地址的服务器上,比如:33.33.33.33
服务端名称为 nps,其中 conf/nps.conf 为配置文件

其中有保留 bridge 部分,
bridge_type=tcp					# 隧道用于通讯 tcp 协议
bridge_port=8284				# 公网端口(用于内网连接使用)
bridge_ip=0.0.0.0				# 本地监听地址

public_vkey=123					# 用于和内网通讯用验证,对应内网进程npc中的vkey

包括 HTTPS,p2p,web 部分如果不需要可以删除

# 运行,指定配置文件没用,默认的参数似乎无法改变
$ ./nps


客户端是部署在内网服务器上,比如:172.20.20.3
客户端名称为 npc,配置文件 npc.conf

其中 common 和 tcp 部分必须保留
[common]
server_addr=x.x.x.x:8284		    # 服务器端的监听端口,对应于远程公网服务器的端口和地址
conn_type=tcp										# 和服务器端对应,用于tcp通讯
vkey=123												# 对应服务器端的public_vkey

[tcp]														# 这里是具体服务(需要通过公网连接的服务)
mode=tcp												# tcp协议
target_addr=172.20.20.3:22			# 本地服务的地址和端口
server_port=10000								# 映射到公网IP的端口,注意:这个配置不会在服务端配置里出现,是通过这里传输到服务端
																# 服务器端会监听此端口

通过 netstat 命令查看时,服务器端有 10000 和 8284 端口监听,客户端没有端口监听

# 运行
$ ./npc -config npc.conf










